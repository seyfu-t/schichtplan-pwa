---
import { ShiftType, ShiftColors } from "../env.d";

export const shiftColors: ShiftColors = {
  [ShiftType.Nachtschicht]: "bg-red-500",
  [ShiftType.Tagschicht]: "bg-green-500",
  [ShiftType.Frei1]: "bg-blue-400",
  [ShiftType.Frei2]: "bg-yellow-400",
};

// Zyklen für 3x12h
const shifts3x12h = [
  ShiftType.Nachtschicht,
  ShiftType.Frei1,
  ShiftType.Tagschicht,
];

// Zyklen für 4x12h
const shifts4x12h = [
  ShiftType.Nachtschicht, // A
  ShiftType.Frei1, // B
  ShiftType.Frei2, // D
  ShiftType.Tagschicht, // C
];

function getVal3(drift: number, forColor: boolean): ShiftType | "" {
  return shifts3x12h[(cycleIndex3 + drift) % 3] == "F1" && !forColor
    ? ""
    : shifts3x12h[(cycleIndex3 + drift) % 3];
}

function getVal4(drift: number, forColor: boolean): ShiftType | "" {
  return (shifts4x12h[(cycleIndex4 + drift) % 4] == "F1" ||
    shifts4x12h[(cycleIndex4 + drift) % 4] == "F2") &&
    !forColor
    ? ""
    : shifts4x12h[(cycleIndex4 + drift) % 4];
}

// Berechne den Index für den Zyklus basierend auf dem Datum
const BASE_DAY = new Date("2024-01-01").getDate();

const cycleIndex3 = (BASE_DAY - 1) % 3;
const cycleIndex4 = (BASE_DAY - 1) % 4;
---

---

<div
  id="shift-schedule"
  class="w-full max-w-md mx-auto p-5 bg-gray-100 rounded-lg text-center"
>
  <div class="grid grid-cols-8 items-center gap-2">
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      I
    </div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      II
    </div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      III
    </div>
    <div class="shift-cell p-2 rounded-lg text-center cursor-pointer"></div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      A
    </div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      B
    </div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      C
    </div>
    <div class="shift-cell p-2 bg-white rounded-lg text-center cursor-pointer">
      D
    </div>
  </div>

  <div class="grid grid-cols-8 gap-2 mt-2">
    <!-- Schicht 1 bis 3 für 3x12h oder A bis D für 4x12h -->
    <div
      id="shift-1"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal3(0, true)]
      }`}
    >
      {getVal3(0, false)}
    </div>
    <div
      id="shift-2"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal3(1, true)]
      }`}
    >
      {getVal3(1, false)}
    </div>
    <div
      id="shift-3"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal3(2, true)]
      }`}
    >
      {getVal3(2, false)}
    </div>

    <div
      id="shift-gap"
      class="shift-cell p-2 rounded-lg text-center cursor-pointer"
    >
    </div>

    <div
      id="shift-a"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal4(0, true)]
      }`}
    >
      {getVal4(0, false)}
    </div>
    <div
      id="shift-b"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal4(1, true)]
      }`}
    >
      {getVal4(1, false)}
    </div>
    <div
      id="shift-c"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal4(3, true)]
      }`}
    >
      {getVal4(3, false)}
    </div>
    <div
      id="shift-d"
      class:list={`shift-cell text-white p-2 rounded-lg text-center cursor-pointer ${
        shiftColors[getVal4(2, true)]
      }`}
    >
      {getVal4(2, false)}
    </div>
  </div>
</div>
